version: 1
name: nightly_batch_workflow
description: >
  Checklist ensuring the 3 AM automation job executes critical phases in the
  expected order with required prerequisites validated.
steps:
  - id: mqtt_ready
    type: guard
    condition: mqtt_connected
    on_failure: warn
    message: "MQTT not connected; device capability refresh will run in degraded mode."

  - id: incremental_mode_ack
    type: guard
    condition:
      equals: [incremental_enabled, true]
    on_failure: warn
    message: "Incremental processing disabled; detectors will run in full-scan mode."

  - id: fetch_events_step
    type: info
    message: "Fetch last 30 days of Home Assistant events for pattern analysis."

  - id: detector_sequence
    type: info
    message: "Run time-of-day → co-occurrence → ML detectors using configured strategy."

  - id: synergy_sequence
    type: info
    message: "Execute synergy detection and suggestion generation after pattern validation."

